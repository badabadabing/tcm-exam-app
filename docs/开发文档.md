# 中医执业医师第一站复习 Web App 开发文档

## 1. 文档目的

本文档用于统一记录本项目的产品目标、技术实现、页面结构、核心算法、数据模型与迭代日志。  
后续每次功能新增、UI优化或修复，都必须在本文档的「更新日志」中补充记录。

## 2. 项目概述

- 项目名称：`tcm-exam-app`
- 定位：中医执业医师实践技能第一站（病案分析）辨证论治专项刷题工具
- 形态：纯前端单页应用（SPA）
- 核心目标：
  - 将结构化病证数据随机转换为高质量五选一单选题
  - 支持同一证型多题型、多题干变化、多干扰项变化
  - 提供即时解析、错题复盘、收藏与统计反馈

## 3. 技术栈

- 前端框架：React + TypeScript + Vite
- 状态：React 内部状态（当前版本）
- 数据源：`src/data/dataset.ts`（支持运行时数据源切换）
- 出题核心：
  - `src/engine/questionEngine.ts`
  - `src/engine/symptomSampler.ts`
  - `src/engine/distractorGenerator.ts`
- 本地存储：`src/storage/localStore.ts`（Dexie + IndexedDB，兼容旧版 localStorage 迁移）
- 构建：`npm run build`

## 4. 当前功能清单

### 4.1 出题与答题

- 支持 Q1~Q6 六种题型随机生成
- 支持证候裁剪（`is_key` 项必保留，非核心项按比例随机）
- 干扰项三层优先级：
  1. 同病种
  2. 关联病种
  3. 全局池补齐
- 题目选项随机排序
- 提交后展示完整解析：
  - 正确答案
  - 辨证要点
  - 证机概要
  - 治法
  - 方药
  - 完整证候
- 每题倒计时（5分钟），超时自动提交
- 支持模拟考试模式（2题 / 50分钟）：
  - 进入考试后锁定页面切换，防止误触退出
  - 考试中不展示即时解析
  - 支持手动交卷、完成自动交卷、超时自动交卷
  - 交卷后输出成绩页（完成题数、正确率、用时、逐题结果）

### 4.2 学习与统计

- 病种库搜索 + 按科室筛选 + 排序（正确率/覆盖度）
- 错题记录与收藏夹
- 错题筛选（按题型/病种）
- 错题重练（自动切换为其他题型）
- 总体/病种/题型正确率
- 近7天趋势图（答题量 / 正确率 双模式切换）
- 薄弱提醒：
  - 薄弱题型列表
  - 薄弱病种 Top3
- 首页最近练习病种快捷入口

## 5. 页面结构

- `dashboard`：首页（概览、快捷训练、薄弱提醒、最近练习）
- `library`：病种库（搜索、筛选、病种卡片、状态标签）
- `practice`：答题页（题干、选项、提交、解析、计时器）
- `review`：复盘页（错题记录 + 收藏夹）
- `stats`：统计页（趋势图 + 病种统计 + 题型统计 + Top3薄弱病种）

## 6. 数据结构（当前版本）

### 6.1 核心类型

- `Disease`：病种信息、科室、证型列表、关联病种
- `Syndrome`：证型详情、症状项、证机、治法、方药、辨证要点
- `Question`：题型、题干、选项、正确答案索引、解析信息
- `AnswerRecord`：答题记录（含耗时）
- `Bookmark`：收藏题快照

### 6.2 本地存储键

- `tcm_answer_records`：答题记录数组
- `tcm_bookmarks`：收藏题数组

## 7. 运行与开发

```bash
npm install
npm run dev
```

生产构建：

```bash
npm run build
```

## 8. 后续迭代建议

1. 数据层升级：切分 `diseases.json / syndromes.json / templates.json`
2. 存储层升级：迁移到 IndexedDB（Dexie）
3. 统计增强：加入周/月维度、学习时长分布
4. 考试增强：增加多套卷配置与考试历史归档
5. UI增强：统一图标库（如 Lucide），减少文本按钮密度

## 9. 文档维护约定（必须执行）

每次更新代码时，同步更新本文档，至少包含以下内容：

1. 更新日期
2. 更新范围（功能/样式/修复）
3. 涉及文件
4. 验证结果（build/lint/手测）

若本次改动较大，需补充设计说明与影响范围。

## 10. 更新日志

### 2026-02-11（初始 MVP 搭建）

- 新建 React + TypeScript + Vite 项目
- 完成出题引擎、证候裁剪、干扰项生成
- 完成答题/解析/错题/收藏/统计主流程
- 完成基础移动端界面与底部导航
- 构建与 lint 通过

涉及文件（核心）：

- `src/engine/questionEngine.ts`
- `src/engine/symptomSampler.ts`
- `src/engine/distractorGenerator.ts`
- `src/storage/localStore.ts`
- `src/App.tsx`
- `src/App.css`

### 2026-02-11（UI/UX 第一轮重构）

- 对齐设计稿风格：奶油底色、圆角卡片、强状态反馈
- 新增病种库视图（搜索/科室筛选/进度展示）
- 重构答题页与解析区结构
- 增强复盘页和统计页可读性
- 构建与 lint 通过

涉及文件：

- `src/App.tsx`
- `src/App.css`
- `src/index.css`

### 2026-02-11（UI/UX 第二轮增强）

- 新增每题倒计时与低时警示
- 超时自动提交
- 新增近7天趋势图
- 复盘页卡片化（错题与收藏）
- 构建与 lint 通过

涉及文件：

- `src/App.tsx`
- `src/App.css`

### 2026-02-11（UI/UX 第三轮收口）

- 新增趋势图双模式（答题量/正确率）
- 新增病种状态标签（未开始/进行中/需加强/已掌握）
- 新增选项与按钮 focus-visible 可访问态
- 新增首页最近练习病种模块
- 新增统计页薄弱病种 Top3 并支持一键跳转练习
- 构建与 lint 通过

涉及文件：

- `src/App.tsx`
- `src/App.css`
- `docs/开发文档.md`

### 2026-02-11（复盘与题库效率优化）

- 病种库新增排序能力（默认/正确率升降序/覆盖度升降序）
- 复盘页新增筛选能力（按题型、按病种）
- 错题项新增「换题型重练」按钮，自动生成该证型的其他题型练习题
- 构建与 lint 通过

涉及文件：

- `src/App.tsx`
- `src/App.css`
- `docs/开发文档.md`

### 2026-02-12（完整题库接入与移动端适配收口）

- 运行数据源切换为完整题库（59 病种 / 349 证型），通过 `src/data/dataset.ts` 统一管理可切换源
- 补充移动端适配：安全区底部留白、卡片/操作区在小屏下重排、统计与复盘区域在窄屏下避免拥挤
- 统一触屏体验：将 hover 视觉反馈限制在支持 hover 的设备，避免手机端误触动效
- 文档技术栈描述更新为 Dexie + IndexedDB（含旧版 localStorage 迁移）
- 已执行数据校验、构建与 lint 验证

涉及文件：

- `src/data/dataset.ts`
- `src/App.css`
- `docs/开发文档.md`

### 2026-02-12（完整题库下性能优化与复盘修复）

- 优化答题统计聚合逻辑，减少多次重复遍历（病种统计改为单次聚合后复用）
- 复盘页修复：先筛选后截断，避免“先截断再筛选”导致错题被漏掉
- 收藏状态判断改为 `Set` 查询，降低频繁渲染时的线性扫描开销
- 统一提交时间戳采样，避免同次提交重复取当前时间造成的微小误差
- 构建与 lint 通过

涉及文件：

- `src/App.tsx`
- `docs/开发文档.md`

### 2026-02-12（大题库按需加载与分包优化）

- 数据层改为异步加载（`loadDataset`），大题库从主业务包中拆分为独立数据 chunk
- 出题引擎改为显式接收数据集参数，移除对静态全局数据的直接耦合
- 应用新增题库加载态与失败重试机制，保证弱网或首次加载场景的可恢复性
- 构建结果中主 JS 包体积由约 651KB 降至约 317KB（其余体积转移到数据 chunk）
- 构建与 lint 通过

涉及文件：

- `src/data/dataset.ts`
- `src/engine/questionEngine.ts`
- `src/engine/distractorGenerator.ts`
- `src/App.tsx`
- `docs/开发文档.md`

### 2026-02-12（加载进度与后台预热优化）

- 应用初始化新增分阶段加载反馈（本地存储连接、题库加载、学习记录同步）
- 题库加载卡片新增进度显示与可视化进度条，降低首次启动等待的不确定感
- 新增后台空闲预热：自动预生成“随机刷题 10 题”和“Q1 专项 10 题”缓存
- 快捷训练优先消费预热缓存，点击后立即进入练习，同时自动触发下一轮缓存补充
- 构建与 lint 通过

涉及文件：

- `src/App.tsx`
- `docs/开发文档.md`

### 2026-02-12（考试模式落地）

- 新增模拟考试入口（2题 / 50分钟），并接入完整答题链路
- 实现考试计时、手动交卷、超时自动交卷与完成自动交卷
- 考试模式下关闭即时解析，避免作答过程泄题
- 新增考试成绩页：完成题数、正确率、用时、逐题结果
- 考试进行中限制底部导航和顶部统计跳转，防止误退出导致计时失真
- 构建与 lint 通过

涉及文件：

- `src/App.tsx`
- `src/App.css`
- `docs/开发文档.md`
